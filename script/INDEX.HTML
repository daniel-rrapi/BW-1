<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .circle-timer {
        position: relative;
        width: 100px;
        height: 100px;
      }

      .circular-chart {
        display: block;
        width: 100%;
        padding-bottom: 100%;
        background: #fff;
        border-radius: 50%;
      }

      .circle-bg {
        fill: none;
        stroke: #eee;
        stroke-width: 2;
      }

      .circle {
        fill: none;
        stroke: #ff2c70;
        stroke-width: 2;
        stroke-linecap: round;
        animation: progress 1s ease-out forwards;
      }

      .time-left {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-weight: bold;
      }

      @keyframes progress {
        0% {
          stroke-dasharray: 0 100;
        }
      }
    </style>
  </head>
  <body>
    <nav>
      <img src="./assets/imgs/epicode_logo.png" alt="" />
    </nav>

    <div id="question-container"></div>
    <div id="question-index">Domanda 1 di X</div>
    <button id="next-button" onclick="nextQuestion()" style="visibility: hidden">Domanda successiva</button>
    <div id="result-container"></div>
    <div class="circle-timer">
      <svg viewBox="0 0 36 36" class="circular-chart">
        <path
          class="circle-bg"
          d="M18 2.0845
                a 15.9155 15.9155 0 0 1 0 31.831
                a 15.9155 15.9155 0 0 1 0 -31.831"
        />
        <path
          class="circle"
          stroke-dasharray="65, 100"
          d="M18 2.0845
                a 15.9155 15.9155 0 0 1 0 31.831
                a 15.9155 15.9155 0 0 1 0 -31.831"
        />
      </svg>

      <div class="time-left">60</div>
    </div>

    <script>
      const questions = [
        {
          category: "Science: Computers",
          type: "multiple",
          difficulty: "easy",
          question: "What does CPU stand for?",
          correct_answer: "Central Processing Unit",
          incorrect_answers: ["Central Process Unit", "Computer Personal Unit", "Central Processor Unit"],
        },
        {
          category: "Science: Computers",
          type: "multiple",
          difficulty: "easy",
          question:
            "In the programming language Java, which of these keywords would you put on a variable to make sure it doesn't get modified?",
          correct_answer: "Final",
          incorrect_answers: ["Static", "Private", "Public"],
        },
        {
          category: "Science: Computers",
          type: "boolean",
          difficulty: "easy",
          question: "The logo for Snapchat is a Bell.",
          correct_answer: "False",
          incorrect_answers: ["True"],
        },
        {
          category: "Science: Computers",
          type: "boolean",
          difficulty: "easy",
          question: "Pointers were not used in the original C programming language; they were added later on in C++.",
          correct_answer: "False",
          incorrect_answers: ["True"],
        },
        {
          category: "Science: Computers",
          type: "multiple",
          difficulty: "easy",
          question: "What is the most preferred image format used for logos in the Wikimedia database?",
          correct_answer: ".svg",
          incorrect_answers: [".png", ".jpeg", ".gif"],
        },
        {
          category: "Science: Computers",
          type: "multiple",
          difficulty: "easy",
          question: "In web design, what does CSS stand for?",
          correct_answer: "Cascading Style Sheet",
          incorrect_answers: ["Counter Strike: Source", "Corrective Style Sheet", "Computer Style Sheet"],
        },
        {
          category: "Science: Computers",
          type: "multiple",
          difficulty: "easy",
          question: "What is the code name for the mobile operating system Android 7.0?",
          correct_answer: "Nougat",
          incorrect_answers: ["Ice Cream Sandwich", "Jelly Bean", "Marshmallow"],
        },
        {
          category: "Science: Computers",
          type: "multiple",
          difficulty: "easy",
          question: "On Twitter, what is the character limit for a Tweet?",
          correct_answer: "140",
          incorrect_answers: ["120", "160", "100"],
        },
        {
          category: "Science: Computers",
          type: "boolean",
          difficulty: "easy",
          question: "Linux was first created as an alternative to Windows XP.",
          correct_answer: "False",
          incorrect_answers: ["True"],
        },
        {
          category: "Science: Computers",
          type: "multiple",
          difficulty: "easy",
          question: "Which programming language shares its name with an island in Indonesia?",
          correct_answer: "Java",
          incorrect_answers: ["Python", "C", "Jakarta"],
        },
      ];

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      shuffleArray(questions);

      let currentQuestionIndex = 0;
      let score = 0;
      const questionContainer = document.getElementById("question-container");
      const resultContainer = document.getElementById("result-container");
      const questionIndexElement = document.getElementById("question-index");
      let startTime;
      let duration;

      function updateCircleTimer() {
        let elapsed = performance.now() - startTime;
        let timeLeft = duration - elapsed;
        if (timeLeft <= 0) {
          timeLeft = 0;
          nextQuestion();
          return;
        }
        const circle = document.querySelector(".circle");
        const timeLeftLabel = document.querySelector(".time-left");
        let percentage = (timeLeft / duration) * 100;
        circle.setAttribute("stroke-dasharray", ` ${percentage}, 100`);
        timeLeftLabel.textContent = Math.ceil(timeLeft / 1000);
        if (timeLeft > 0) {
          requestAnimationFrame(updateCircleTimer);
        }
      }

      function resetTimer() {
        const questionType = questions[currentQuestionIndex].type;
        duration = questionType === "boolean" ? 30 * 1000 : 60 * 1000;
        startTime = performance.now();
        updateCircleTimer();
      }

      function displayQuestion() {
        const question = questions[currentQuestionIndex];
        if (!question) {
          questionContainer.innerHTML = "";
          resultContainer.innerHTML = `Punteggio finale: ${score} su ${questions.length}`;
          questionIndexElement.style.display = "none";
          return;
        }

        questionIndexElement.textContent = `Domanda ${currentQuestionIndex + 1} di ${questions.length}`;
        questionContainer.innerHTML = `<p>${question.question}</p>`;
        question.incorrect_answers.forEach((answer) => {
          questionContainer.innerHTML += `
      <input type="radio" name="answer" value="${answer}" id="${answer}">
      <label for="${answer}">${answer}</label>`;
        });
        questionContainer.innerHTML += `
    <input type="radio" name="answer" value="${question.correct_answer}" id="${question.correct_answer}">
    <label for="${question.correct_answer}">${question.correct_answer}</label>`;
        questionContainer.innerHTML += `
    <button id="next-button" onclick="nextQuestion()" style="visibility: hidden;">Domanda successiva</button>`;
        const answerOptions = document.querySelectorAll('input[name="answer"]');
        answerOptions.forEach((option) => {
          option.addEventListener("change", handleAnswerSelection);
        });
        checkSelectedAnswer();
        resetTimer();
      }

      function nextQuestion() {
        resetTimer();
        const selectedAnswer = document.querySelector('input[name="answer"]:checked');
        if (selectedAnswer && selectedAnswer.value === questions[currentQuestionIndex].correct_answer) {
          score++;
        }
        currentQuestionIndex++;
        if (currentQuestionIndex >= questions.length) {
          questionContainer.innerHTML = "";
          resultContainer.innerHTML = `Punteggio finale: ${score} su ${questions.length}`;
          questionIndexElement.style.display = "none";
          hideTimer();
        } else {
          displayQuestion();
        }
      }
      function hideTimer() {
        const timerElement = document.querySelector(".circle-timer");
        timerElement.style.display = "none";
      }

      function checkSelectedAnswer() {
        const selectedAnswer = document.querySelector('input[name="answer"]:checked');
        const nextButton = document.getElementById("next-button");
        if (selectedAnswer) {
          nextButton.style.visibility = "visible";
        } else {
          nextButton.style.visibility = "hidden";
        }
      }

      function handleAnswerSelection() {
        checkSelectedAnswer();
      }

      displayQuestion();
    </script>
  </body>
</html>
